<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{UI/layouts/user/my_layout}"
      >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 내역 - 분수마켓</title>
</head>
<body layout:fragment="content">

  <div class="card">
    <div class="card-header">
      <h5>주문 내역 조회</h5>
    </div>
    <div class="card-body">
      <!-- 주문 목록 -->
      <div class="order-list">
        <th:block th:each="order : ${pageInfo.list}">
          <!-- 주문 항목 -->
          <div class="border p-3 mb-3 rounded">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="fw-bold" th:text="'주문번호: ' + ${order.code}">주문번호: 20250630001</span>
              <th:block th:if="${order.status == '결제완료'}">
                <span class="badge bg-success" th:text="${order.status}">결제완료</span>
              </th:block>
              <th:block th:if="${order.status == '결제대기'}">
                <span class="badge bg-secondary" th:text="${order.status}">결제대기</span>
              </th:block>
              <th:block th:if="${order.status == '주문취소'}">
                <span class="badge bg-danger" th:text="${order.status}">주문취소</span>
              </th:block>
              
            </div>
            <div class="row justify-content-between align-items-center">
              <div class="col-md-2">
                <img th:src="${order.orderItems != null && order.orderItems.size() > 0 && order.orderItems[0].product != null && order.orderItems[0].product.thumbImg != null ? order.orderItems[0].product.thumbImg.content : 'https://placehold.co/120x120?text=Image'}" 
                  th:alt="${order.orderItems != null && order.orderItems.size() > 0 && order.orderItems[0].product != null ? order.orderItems[0].product.name : '상품 이미지'}"
                  width="120" height="120" class="rounded">
              </div>
              <div class="col-md-6">
                <h6 th:text="${order.title}">주문제목</h6>
                <p class="text-muted mb-1">옵션:</p>
                <p class="text-muted mb-1"> 
                  <th:block th:each="item, itemStat : ${order.orderItems}">
                    <th:block th:each="option, optionStat : ${item.orderItemOptions}">
                      <span th:text="${option.option.name} + ': ' + ${#numbers.formatInteger(option.option.price * option.quantity, 0, 'COMMA')}"></span>
                      <span th:text="|(${#numbers.formatInteger(option.option.price, 0, 'COMMA')}x${#numbers.formatInteger(option.quantity, 0, 'COMMA')})|">옵션명 (2개)</span>
                      <span th:if="!${optionStat.last}">, </span>
                    </th:block>
                    <span th:if="!${itemStat.last}"> | </span>
                  </th:block>
                </p>
                <p class="text-muted mb-1" th:text="'배송비: ₩' + ${#numbers.formatInteger(order.shipPrice, 3, 'COMMA')}">배송비: ₩3,000</p>
                <p class="text-muted mb-1" th:text="'수량: ' + ${order.orderItems.size()} + '개'">수량: 1개</p>
              </div>
              <div class="col-md-2">
                <p class="fw-bold" th:text="'₩' + ${order.totalPrice != null ? #numbers.formatInteger(order.totalPrice, 3, 'COMMA') : '0'}">₩20,000</p>
                <th:block th:if="${order.status == '결제대기'}">
                  <a th:href="@{/pay/order/{id}(id=${order.id})}" class="btn btn-primary btn-sm mt-2">결제하기</a>
                </th:block>
                <th:block th:if="${order.status == '결제완료'}">
                  <a th:href="@{/my/cancel/{id}(id=${order.id})}" class="btn btn-danger btn-sm mt-2">주문취소</a>
                </th:block>
              </div>
              
            </div>
            <div class="text-end mt-2">
              <small class="text-muted" th:text="'주문일시: ' + ${#dates.format(order.createdAt, 'yyyy.MM.dd')}">주문일시: 2025.06.30</small>
            </div>
          </div>
        </th:block>
        
        <!-- 주문이 없을 때 -->
        <th:block th:if="${pageInfo.list.size() == 0}">
          <div class="text-center py-5">
            <i class="material-icons" style="font-size: 48px; color: #ccc;">shopping_cart</i>
            <p class="text-muted mt-3">주문 내역이 없습니다.</p>
            <a href="/" class="btn btn-primary">쇼핑하러 가기</a>
          </div>
        </th:block>
      </div>
      
      <!-- 페이지 -->
      <th:block th:replace="~{UI/fragments/common/page::page}"></th:block>

      
    </div>
  </div>

  <!-- 스페이스 : s-lg -->
  <div class="s-lg"></div>


</body>
</html>
